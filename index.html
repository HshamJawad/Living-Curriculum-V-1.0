<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>AI-Supported Activity Sheet</title>

  <style>
    * { box-sizing: border-box; }
    
    body { 
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
      background: #f5f5f5;
      padding: 24px 20px;
      margin: 0;
      color: #1a1a1a;
      line-height: 1.5;
    }
    
    .activity { 
      background: #ffffff;
      padding: 32px;
      border-radius: 8px;
      max-width: 980px;
      margin: 0 auto;
      box-shadow: 0 1px 3px rgba(0,0,0,0.06);
    }
    
    .header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 24px;
      padding-bottom: 20px;
      border-bottom: 1px solid #e5e5e5;
    }
    
    h1 { 
      margin: 0 0 6px;
      font-size: 24px;
      font-weight: 600;
      color: #1a1a1a;
    }
    
    .subtitle {
      color: #666;
      font-size: 14px;
      margin: 0;
    }
    
    .lang-toggle {
      display: flex;
      gap: 0;
      background: #f0f0f0;
      border-radius: 6px;
      padding: 2px;
    }
    
    .lang-btn {
      padding: 6px 16px;
      background: transparent;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 13px;
      font-weight: 500;
      color: #666;
      transition: all 0.2s;
    }
    
    .lang-btn.active {
      background: #ffffff;
      color: #1a1a1a;
      box-shadow: 0 1px 2px rgba(0,0,0,0.08);
    }
    
    .step { 
      border: 1px solid #e0e0e0;
      padding: 24px;
      border-radius: 8px;
      margin: 20px 0;
      background: #fafafa;
    }
    
    .step-title { 
      font-weight: 600;
      margin-bottom: 8px;
      font-size: 16px;
      color: #1a1a1a;
    }
    
    .step > p {
      margin: 0 0 16px;
      color: #4a4a4a;
      font-size: 14px;
    }
    
    .row { 
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      align-items: center;
    }
    
    button {
      padding: 8px 16px;
      font-size: 14px;
      font-weight: 500;
      border: 1px solid #d0d0d0;
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.15s;
      font-family: inherit;
    }
    
    button.primary {
      background: #2d2d2d;
      color: #ffffff;
      border-color: #2d2d2d;
    }
    
    button.primary:hover:not(:disabled) {
      background: #1a1a1a;
      border-color: #1a1a1a;
    }
    
    button.secondary {
      background: #ffffff;
      color: #2d2d2d;
    }
    
    button.secondary:hover:not(:disabled) {
      background: #f5f5f5;
    }
    
    button.success {
      background: #16a34a;
      color: #ffffff;
      border-color: #16a34a;
    }
    
    button.success:hover:not(:disabled) {
      background: #15803d;
      border-color: #15803d;
    }
    
    button.danger {
      background: #dc2626;
      color: #ffffff;
      border-color: #dc2626;
    }
    
    button.danger:hover:not(:disabled) {
      background: #b91c1c;
      border-color: #b91c1c;
    }
    
    button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    
    .box { 
      margin-top: 16px;
      background: #ffffff;
      border: 1px solid #e5e5e5;
      border-radius: 8px;
      padding: 16px;
    }
    
    .imgwrap { 
      min-height: 200px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .imgwrap img { 
      width: 100%;
      max-width: 100%;
      border-radius: 6px;
      display: block;
    }
    
    .loading { 
      font-style: italic;
      color: #666;
      font-size: 14px;
    }
    
    .guidance {
      width: 100%;
      min-height: 72px;
      resize: vertical;
      padding: 12px;
      border-radius: 6px;
      border: 1px solid #d0d0d0;
      font-size: 14px;
      font-family: inherit;
      line-height: 1.4;
    }
    
    .guidance:focus {
      outline: none;
      border-color: #2d2d2d;
    }
    
    .label {
      font-size: 13px;
      color: #666;
      margin-bottom: 8px;
      font-weight: 500;
    }
    
    .criteria { 
      margin-top: 16px;
    }
    
    .criteria-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 16px;
      padding-bottom: 12px;
      border-bottom: 1px solid #e5e5e5;
    }
    
    .criteria-header strong {
      font-size: 15px;
      color: #1a1a1a;
      font-weight: 600;
    }
    
    .criteria-header .label {
      margin: 4px 0 0;
    }
    
    .criteria-item { 
      display: flex;
      gap: 12px;
      align-items: flex-start;
      padding: 10px 0;
      border-bottom: 1px solid #f0f0f0;
    }
    
    .criteria-item:last-child { 
      border-bottom: none;
    }
    
    .criteria-item label { 
      flex: 1;
      font-size: 14px;
      color: #333;
      cursor: pointer;
    }
    
    .criteria-item input[type="checkbox"] {
      margin-top: 2px;
      cursor: pointer;
      width: 16px;
      height: 16px;
    }
    
    .score-pill {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 6px 14px;
      border-radius: 20px;
      font-size: 13px;
      background: #f0f0f0;
      border: 1px solid #e0e0e0;
      font-weight: 600;
    }
    
    .feedback { 
      white-space: pre-wrap;
      line-height: 1.6;
      font-size: 14px;
      color: #333;
      font-family: inherit;
    }
    
    .footer {
      margin-top: 32px;
      padding-top: 20px;
      border-top: 1px solid #e5e5e5;
      font-size: 12px;
      color: #666;
      line-height: 1.6;
    }
    
    /* RTL Support */
    [dir="rtl"] {
      text-align: right;
    }
    
    [dir="rtl"] .header {
      flex-direction: row-reverse;
    }
    
    [dir="rtl"] .row {
      flex-direction: row-reverse;
    }
    
    [dir="rtl"] .criteria-item {
      flex-direction: row-reverse;
    }
    
    [dir="rtl"] .criteria-header {
      flex-direction: row-reverse;
    }
  </style>
</head>
<body>

<div class="activity">
  <div class="header">
    <div>
      <h1 data-i18n="title">Activity Sheet</h1>
      <p class="subtitle" data-i18n="subtitle">Living Curriculum Prototype</p>
    </div>
    <div class="lang-toggle">
      <button class="lang-btn active" data-lang="en">English</button>
      <button class="lang-btn" data-lang="ar">Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</button>
    </div>
  </div>
 <!-- HOW TO USE -->
<div class="box" style="margin-bottom:24px;">
<strong data-i18n="howto_title">How to use</strong>
  <ol style="margin-top:12px; padding-inline-start:20px; line-height:1.8;" data-i18n="howto_list">
    <li>Read the activity step carefully.</li>
    <li>Click <b>Generate Illustration</b> to create a visual explanation.</li>
    <li>If the image is unclear, click <b>Suggest Guidance</b>.</li>
    <li>Optionally edit the guidance, then click <b>Regenerate with Guidance</b>.</li>
    <li>When satisfied, click <b>Save Image</b>.</li>
    <li>Review the image using the <b>Performance Criteria</b>.</li>
    <li>Use <b>Delete Image</b> or <b>Clear</b> to remove saved outputs.</li>
    <li>Switch language anytime using the EN / AR buttons.</li>
  </ol>
</div>

  <!-- STEP 1 -->
  <div class="step" data-occupation="electrician" data-task="turn off main power supply">
    <div class="step-title" data-i18n="step1_title">Step 1: Turn off the main power supply</div>
    <p data-i18n="step1_desc">Ensure the electrical supply is disconnected before starting work.</p>

    <div class="box">
      <div class="row">
        <button class="primary" onclick="generateIllustration(this)" data-i18n="btn_generate">Generate Illustration</button>
        <button class="secondary" onclick="regenerateWithGuidance(this)" data-i18n="btn_regenerate">Regenerate with Guidance</button>
        <button class="secondary" onclick="suggestGuidance(this)" data-i18n="btn_suggest">Suggest Guidance</button>
        <button class="success" onclick="saveStepImage(this)" data-i18n="btn_save">Save Image</button>
        <button class="danger delete-img-btn" onclick="deleteStepImage(this)" data-i18n="btn_delete" style="display:none;">Delete Image</button>
        <button class="danger" onclick="clearOutputs(this)" data-i18n="btn_clear">Clear</button>
      </div>

      <div style="margin-top:16px;">
        <div class="label" data-i18n="label_guidance">Guidance (optional):</div>
        <textarea class="guidance" data-i18n-placeholder="placeholder_guidance"></textarea>
      </div>

      <div class="box imgwrap" style="margin-top:16px;">
        <div class="loading" data-i18n="no_image">No image generated yet.</div>
      </div>
    </div>

    <div class="box criteria">
      <div class="criteria-header">
        <div>
          <strong data-i18n="criteria_title">Performance Criteria (Self-check)</strong>
          <div class="label" data-i18n="criteria_subtitle">Check each item after viewing the illustration and reading the step.</div>
        </div>
      </div>

      <div class="criteria-list">
        <div class="criteria-item">
          <input type="checkbox" class="pc" />
          <label data-i18n="step1_c1">Confirmed main power is OFF before starting work (safety first).</label>
        </div>
        <div class="criteria-item">
          <input type="checkbox" class="pc" />
          <label data-i18n="step1_c2">Used correct PPE (e.g., insulated gloves) and safe posture.</label>
        </div>
        <div class="criteria-item">
          <input type="checkbox" class="pc" />
          <label data-i18n="step1_c3">Identified the correct breaker/switch (avoids turning off the wrong circuit).</label>
        </div>
        <div class="criteria-item">
          <input type="checkbox" class="pc" />
          <label data-i18n="step1_c4">Area and panel are clearly visible and hazard-free (no exposed conductors shown).</label>
        </div>
      </div>

      <div class="row" style="margin-top:16px;">
        <button class="secondary" onclick="checkAgainstCriteria(this)" data-i18n="btn_check">Check against Performance Criteria</button>
        <div class="score-pill">
          <span data-i18n="label_score">Score:</span>
          <span class="score">0%</span>
        </div>
      </div>

      <div class="box feedback" style="margin-top:16px;">
        <div class="loading" data-i18n="feedback_placeholder">Feedback will appear here.</div>
      </div>
    </div>
  </div>

  <!-- STEP 2 -->
  <div class="step" data-occupation="electrician" data-task="prepare socket box and wires">
    <div class="step-title" data-i18n="step2_title">Step 2: Prepare the socket box and wires</div>
    <p data-i18n="step2_desc">Strip the wires and prepare the socket box according to standards.</p>

    <div class="box">
      <div class="row">
        <button class="primary" onclick="generateIllustration(this)" data-i18n="btn_generate">Generate Illustration</button>
        <button class="secondary" onclick="regenerateWithGuidance(this)" data-i18n="btn_regenerate">Regenerate with Guidance</button>
        <button class="secondary" onclick="suggestGuidance(this)" data-i18n="btn_suggest">Suggest Guidance</button>
        <button class="success" onclick="saveStepImage(this)" data-i18n="btn_save">Save Image</button>
        <button class="danger delete-img-btn" onclick="deleteStepImage(this)" data-i18n="btn_delete" style="display:none;">Delete Image</button>
        <button class="danger" onclick="clearOutputs(this)" data-i18n="btn_clear">Clear</button>
      </div>

      <div style="margin-top:16px;">
        <div class="label" data-i18n="label_guidance">Guidance (optional):</div>
        <textarea class="guidance" data-i18n-placeholder="placeholder_guidance"></textarea>
      </div>

      <div class="box imgwrap" style="margin-top:16px;">
        <div class="loading" data-i18n="no_image">No image generated yet.</div>
      </div>
    </div>

    <div class="box criteria">
      <div class="criteria-header">
        <div>
          <strong data-i18n="criteria_title">Performance Criteria (Self-check)</strong>
          <div class="label" data-i18n="criteria_subtitle">Check each item after viewing the illustration and reading the step.</div>
        </div>
      </div>

      <div class="criteria-list">
        <div class="criteria-item">
          <input type="checkbox" class="pc" />
          <label data-i18n="step2_c1">Selected correct tools (e.g., wire stripper) and used them safely.</label>
        </div>
        <div class="criteria-item">
          <input type="checkbox" class="pc" />
          <label data-i18n="step2_c2">Stripped insulation to appropriate length without nicking conductors.</label>
        </div>
        <div class="criteria-item">
          <input type="checkbox" class="pc" />
          <label data-i18n="step2_c3">Socket box is positioned/secured correctly (level and stable).</label>
        </div>
        <div class="criteria-item">
          <input type="checkbox" class="pc" />
          <label data-i18n="step2_c4">Work area is clean; no exposed hazards shown in the illustration.</label>
        </div>
      </div>

      <div class="row" style="margin-top:16px;">
        <button class="secondary" onclick="checkAgainstCriteria(this)" data-i18n="btn_check">Check against Performance Criteria</button>
        <div class="score-pill">
          <span data-i18n="label_score">Score:</span>
          <span class="score">0%</span>
        </div>
      </div>

      <div class="box feedback" style="margin-top:16px;">
        <div class="loading" data-i18n="feedback_placeholder">Feedback will appear here.</div>
      </div>
    </div>
  </div>

  <div class="footer">
    <strong data-i18n="footer_copyright">Copyright & Disclaimer</strong><br/>
    <span data-i18n="footer_text">Â© 2025 Living Curriculum Prototype | by Husham Jawad Kadhim | Version 1.0 | All rights reserved. This prototype is provided "as is" for educational and demonstration purposes. It may generate inaccurate or incomplete outputs. Users are responsible for validating safety, technical standards, and compliance with local regulations before any real-world application. This tool is not affiliated with, endorsed by, or sponsored by any organization unless explicitly stated.</span>
  </div>
</div>

<script>
// ============================================================================
// TRANSLATION DICTIONARY
// ============================================================================
const translations = {
  en: {
    title: "Activity Sheet",
    subtitle: "Living Curriculum Prototype",

    howto_title: "How to use",
    howto_list: `
      <li>Read the activity step carefully.</li>
      <li>Click <b>Generate Illustration</b> to create a visual explanation.</li>
      <li>If the image is unclear, click <b>Suggest Guidance</b>.</li>
      <li>Optionally edit the guidance, then click <b>Regenerate with Guidance</b>.</li>
      <li>When satisfied, click <b>Save Image</b>.</li>
      <li>Review the image using the <b>Performance Criteria</b>.</li>
      <li>Use <b>Delete Image</b> or <b>Clear</b> to remove saved outputs.</li>
      <li>Switch language anytime using the EN / AR buttons.</li>
    `,

    btn_generate: "Generate Illustration",
    btn_regenerate: "Regenerate with Guidance",
    btn_suggest: "Suggest Guidance",
    btn_save: "Save Image",
    btn_delete: "Delete Image",
    btn_clear: "Clear",
loading_generate: "â³ Generating illustration, please wait...",
loading_regenerate: "â³ Regenerating illustration with guidance...",
loading_hint: "This may take a few seconds.",

    label_guidance: "Guidance (optional):",
    placeholder_guidance:
      "Example: show insulated gloves, correct posture, lockout/tagout, electrical panel visible, realistic training environment, no text labels...",

    no_image: "No image generated yet.",

    criteria_title: "Performance Criteria (Self-check)",
    criteria_subtitle:
      "Check each item after viewing the illustration and reading the step.",

    label_score: "Score:",
    btn_check: "Check against Performance Criteria",

    feedback_placeholder: "Feedback will appear here.",

    step1_title: "Step 1: Turn off the main power supply",
    step1_desc:
      "Ensure the electrical supply is disconnected before starting work.",
step1_c1: "Confirmed main power is OFF before starting work (safety first).",
step1_c2: "Used correct PPE (e.g., insulated gloves) and safe posture.",
step1_c3: "Identified the correct breaker/switch (avoids turning off the wrong circuit).",
step1_c4: "Area and panel are clearly visible and hazard-free (no exposed conductors shown).",
step2_title: "Step 2: Prepare the socket box and wires",
step2_desc: "Strip the wires and prepare the socket box according to standards.",

// Step 2 criteria
step2_c1: "Selected correct tools (e.g., wire stripper) and used them safely.",
step2_c2: "Stripped insulation to appropriate length without nicking conductors.",
step2_c3: "Socket box is positioned/secured correctly (level and stable).",
step2_c4: "Work area is clean; no exposed hazards shown in the illustration.",

    footer_copyright: "Copyright & Disclaimer",
    footer_text:
      "Â© 2025 Living Curriculum Prototype | by Husham Jawad Kadhim | Version 1.0 | All rights reserved.",

    feedback_good: "âœ… Looks good. Proceed to practice.",
    feedback_partial: "ğŸŸ¡ Partial. Review missing criteria.",
    feedback_not_ready: "ğŸ”´ Not ready. Re-check safety.",
    feedback_score: "Score:",
    feedback_missing: "Missing criteria:",
    feedback_none: "- None",
    feedback_improvements: "Next improvement:",
    feedback_suggested:
      "âœ… Suggested guidance added. Use Regenerate with Guidance."
  },

  ar: {
  title: "ÙˆØ±Ù‚Ø© Ø§Ù„Ù†Ø´Ø§Ø·",
  subtitle: "Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ù…Ù†Ù‡Ø¬ Ø§Ù„Ø­ÙŠ",

  howto_title: "Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…",
  howto_list: `
    <li>Ø§Ù‚Ø±Ø£ Ø®Ø·ÙˆØ§Øª Ø§Ù„Ù†Ø´Ø§Ø· Ø¨Ø¹Ù†Ø§ÙŠØ©.</li>
    <li>Ø§Ø¶ØºØ· <b>ØªÙˆÙ„ÙŠØ¯ ØµÙˆØ±Ø©</b> Ù„Ø¥Ù†Ø´Ø§Ø¡ ØªÙˆØ¶ÙŠØ­ Ø¨ØµØ±ÙŠ Ù„Ø®Ø·ÙˆØ© Ø§Ù„Ù†Ø´Ø§Ø·.</li>
    <li>Ø¥Ø°Ø§ Ù„Ù… ØªÙƒÙ† Ø§Ù„ØµÙˆØ±Ø© ÙˆØ§Ø¶Ø­Ø©ØŒ Ø§Ø¶ØºØ· <b>Ø§Ù‚ØªØ±Ø§Ø­ Ø§Ù„ØªÙˆØ¬ÙŠÙ‡</b>.</li>
    <li>ÙŠÙ…ÙƒÙ†Ùƒ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„ØªÙˆØ¬ÙŠÙ‡ Ø«Ù… Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ <b>Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªÙˆÙ„ÙŠØ¯ Ù…Ø¹ Ø§Ù„ØªÙˆØ¬ÙŠÙ‡</b>.</li>
    <li>Ø¹Ù†Ø¯ Ø§Ù„Ø±Ø¶Ø§ Ø¹Ù† Ø§Ù„Ù†ØªÙŠØ¬Ø©ØŒ Ø§Ø¶ØºØ· <b>Ø­ÙØ¸ Ø§Ù„ØµÙˆØ±Ø©</b>.</li>
    <li>Ø±Ø§Ø¬Ø¹ Ø§Ù„ØµÙˆØ±Ø© Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… <b>Ù…Ø¹Ø§ÙŠÙŠØ± Ø§Ù„Ø£Ø¯Ø§Ø¡</b>.</li>
    <li>Ø§Ø³ØªØ®Ø¯Ù… <b>Ø§Ø³ØªØ®Ø¯Ù… Ø®ÙŠØ§Ø±  Ø­Ø°Ù Ø§Ù„ØµÙˆØ±Ø©</b> <b>Ø£Ùˆ Ù…Ø³Ø­ Ù„Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ù…Ø®Ø±Ø¬Ø§Øª Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©</b>.</li>
    <li>ÙŠÙ…ÙƒÙ†Ùƒ ØªØºÙŠÙŠØ± Ø§Ù„Ù„ØºØ© ÙÙŠ Ø£ÙŠ ÙˆÙ‚Øª.</li>
  `,

  btn_generate: "ØªÙˆÙ„ÙŠØ¯ ØµÙˆØ±Ø©",
  btn_regenerate: "Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªÙˆÙ„ÙŠØ¯ Ù…Ø¹ Ø§Ù„ØªÙˆØ¬ÙŠÙ‡",
  btn_suggest: "Ø§Ù‚ØªØ±Ø§Ø­ Ø§Ù„ØªÙˆØ¬ÙŠÙ‡",
  btn_save: "Ø­ÙØ¸ Ø§Ù„ØµÙˆØ±Ø©",
  btn_delete: "Ø­Ø°Ù Ø§Ù„ØµÙˆØ±Ø©",
  btn_clear: "Ù…Ø³Ø­",
loading_generate: "â³ Ø¬Ø§Ø±Ù ØªÙˆÙ„ÙŠØ¯ Ø§Ù„ØªÙˆØ¶ÙŠØ­ØŒ ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±...",
loading_regenerate: "â³ Ø¬Ø§Ø±Ù Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªÙˆÙ„ÙŠØ¯ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„ØªÙˆØ¬ÙŠÙ‡...",
loading_hint: "Ù‚Ø¯ ØªØ³ØªØºØ±Ù‚ Ø§Ù„Ø¹Ù…Ù„ÙŠØ© Ø¨Ø¶Ø¹ Ø«ÙˆØ§Ù†Ù.",

  label_guidance: "Ø§Ù„ØªÙˆØ¬ÙŠÙ‡ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ):",
  placeholder_guidance: "Ù…Ø«Ø§Ù„: Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ù‚ÙØ§Ø²Ø§Øª Ø§Ù„Ø¹Ø§Ø²Ù„Ø©ØŒ Ø§Ù„ÙˆØ¶Ø¹ÙŠØ© Ø§Ù„ØµØ­ÙŠØ­Ø©ØŒ Ù‚ÙÙ„/ÙˆØ¶Ø¹ Ø¹Ù„Ø§Ù…Ø©ØŒ Ù„ÙˆØ­Ø© ÙƒÙ‡Ø±Ø¨Ø§Ø¦ÙŠØ© Ù…Ø±Ø¦ÙŠØ©ØŒ Ø¨ÙŠØ¦Ø© ØªØ¯Ø±ÙŠØ¨ ÙˆØ§Ù‚Ø¹ÙŠØ©ØŒ Ø¨Ø¯ÙˆÙ† ØªØ³Ù…ÙŠØ§Øª Ù†ØµÙŠØ©...",
  no_image: "Ù„Ù… ÙŠØªÙ… Ø¥Ù†Ø´Ø§Ø¡ ØµÙˆØ±Ø© Ø¨Ø¹Ø¯.",

  criteria_title: "Ù…Ø¹Ø§ÙŠÙŠØ± Ø§Ù„Ø£Ø¯Ø§Ø¡ (ÙØ­Øµ Ø°Ø§ØªÙŠ)",
  criteria_subtitle: "ØªØ­Ù‚Ù‚ Ù…Ù† ÙƒÙ„ Ø¹Ù†ØµØ± Ø¨Ø¹Ø¯ Ø¹Ø±Ø¶ Ø§Ù„ØªÙˆØ¶ÙŠØ­ ÙˆÙ‚Ø±Ø§Ø¡Ø© Ø§Ù„Ø®Ø·ÙˆØ©.",
  label_score: "Ø§Ù„Ù†ØªÙŠØ¬Ø©:",
  btn_check: "Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ù…Ø¹Ø§ÙŠÙŠØ± Ø§Ù„Ø£Ø¯Ø§Ø¡",
  feedback_placeholder: "Ø³ØªØ¸Ù‡Ø± Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ù‡Ù†Ø§.",

  step1_title: "Ø§Ù„Ø®Ø·ÙˆØ© 1: Ø¥ÙŠÙ‚Ø§Ù ØªØ´ØºÙŠÙ„ Ù…ØµØ¯Ø± Ø§Ù„Ø·Ø§Ù‚Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ",
  step1_desc: "ØªØ£ÙƒØ¯ Ù…Ù† ÙØµÙ„ Ù…ØµØ¯Ø± Ø§Ù„Ø·Ø§Ù‚Ø© Ø§Ù„ÙƒÙ‡Ø±Ø¨Ø§Ø¦ÙŠØ© Ù‚Ø¨Ù„ Ø¨Ø¯Ø¡ Ø§Ù„Ø¹Ù…Ù„.",

  step1_c1: "ØªÙ… ØªØ£ÙƒÙŠØ¯ Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ø·Ø§Ù‚Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© Ù‚Ø¨Ù„ Ø¨Ø¯Ø¡ Ø§Ù„Ø¹Ù…Ù„ (Ø§Ù„Ø³Ù„Ø§Ù…Ø© Ø£ÙˆÙ„Ø§Ù‹).",
  step1_c2: "Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù…Ø¹Ø¯Ø§Øª Ø§Ù„Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ø´Ø®ØµÙŠØ© Ø§Ù„ØµØ­ÙŠØ­Ø© (Ù…Ø«Ù„ Ø§Ù„Ù‚ÙØ§Ø²Ø§Øª Ø§Ù„Ø¹Ø§Ø²Ù„Ø©) ÙˆØ§Ù„ÙˆØ¶Ø¹ÙŠØ© Ø§Ù„Ø¢Ù…Ù†Ø©.",
  step1_c3: "ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù‚Ø§Ø·Ø¹/Ø§Ù„Ù…ÙØªØ§Ø­ Ø§Ù„ØµØ­ÙŠØ­ (ØªØ¬Ù†Ø¨ Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ø¯Ø§Ø¦Ø±Ø© Ø§Ù„Ø®Ø§Ø·Ø¦Ø©).",
  step1_c4: "Ø§Ù„Ù…Ù†Ø·Ù‚Ø© ÙˆØ§Ù„Ù„ÙˆØ­Ø© Ù…Ø±Ø¦ÙŠØ© Ø¨ÙˆØ¶ÙˆØ­ ÙˆØ®Ø§Ù„ÙŠØ© Ù…Ù† Ø§Ù„Ù…Ø®Ø§Ø·Ø± (Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…ÙˆØµÙ„Ø§Øª Ù…ÙƒØ´ÙˆÙØ©).",

  step2_title: "Ø§Ù„Ø®Ø·ÙˆØ© 2: ØªØ­Ø¶ÙŠØ± ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ù…Ù‚Ø¨Ø³ ÙˆØ§Ù„Ø£Ø³Ù„Ø§Ùƒ",
  step2_desc: "Ù‚Ù… Ø¨ØªØ¬Ø±ÙŠØ¯ Ø§Ù„Ø£Ø³Ù„Ø§Ùƒ ÙˆØªØ­Ø¶ÙŠØ± ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ù…Ù‚Ø¨Ø³ ÙˆÙÙ‚Ø§Ù‹ Ù„Ù„Ù…Ø¹Ø§ÙŠÙŠØ±.",
  step2_c1: "ØªÙ… Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø£Ø¯ÙˆØ§Øª Ø§Ù„ØµØ­ÙŠØ­Ø© (Ù…Ø«Ù„ Ø£Ø¯Ø§Ø© ØªØ¬Ø±ÙŠØ¯ Ø§Ù„Ø£Ø³Ù„Ø§Ùƒ) ÙˆØ§Ø³ØªØ®Ø¯Ø§Ù…Ù‡Ø§ Ø¨Ø£Ù…Ø§Ù†.",
  step2_c2: "ØªÙ… ØªØ¬Ø±ÙŠØ¯ Ø§Ù„Ø¹Ø²Ù„ Ø¨Ø§Ù„Ø·ÙˆÙ„ Ø§Ù„Ù…Ù†Ø§Ø³Ø¨ Ø¯ÙˆÙ† Ø¥ØªÙ„Ø§Ù Ø§Ù„Ù…ÙˆØµÙ„Ø§Øª.",
  step2_c3: "ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ù…Ù‚Ø¨Ø³ ÙÙŠ Ø§Ù„Ù…ÙˆØ¶Ø¹/Ù…Ø«Ø¨Øª Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­ (Ù…Ø³ØªÙˆÙŠ ÙˆÙ…Ø³ØªÙ‚Ø±).",
  step2_c4: "Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø¹Ù…Ù„ Ù†Ø¸ÙŠÙØ©Ø› Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø®Ø§Ø·Ø± Ù…ÙƒØ´ÙˆÙØ© ÙÙŠ Ø§Ù„ØªÙˆØ¶ÙŠØ­.",

  footer_copyright: "Ø­Ù‚ÙˆÙ‚ Ø§Ù„Ù†Ø´Ø± ÙˆØ¥Ø®Ù„Ø§Ø¡ Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ÙŠØ©",
  footer_text: "Â© 2025 Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ù…Ù†Ù‡Ø¬ Ø§Ù„Ø­ÙŠ. Ø¨ÙˆØ§Ø³Ø·Ø© Ù‡Ø´Ø§Ù… Ø¬ÙˆØ§Ø¯ ÙƒØ§Ø¸Ù…. Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø©. ÙŠØªÙ… ØªÙˆÙÙŠØ± Ù‡Ø°Ø§ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ \"ÙƒÙ…Ø§ Ù‡Ùˆ\" Ù„Ø£ØºØ±Ø§Ø¶ ØªØ¹Ù„ÙŠÙ…ÙŠØ© ÙˆØªÙˆØ¶ÙŠØ­ÙŠØ©. Ù‚Ø¯ ÙŠÙ†ØªØ¬ Ù…Ø®Ø±Ø¬Ø§Øª ØºÙŠØ± Ø¯Ù‚ÙŠÙ‚Ø© Ø£Ùˆ ØºÙŠØ± ÙƒØ§Ù…Ù„Ø©. Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙˆÙ† Ù…Ø³Ø¤ÙˆÙ„ÙˆÙ† Ø¹Ù† Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø³Ù„Ø§Ù…Ø© ÙˆØ§Ù„Ù…Ø¹Ø§ÙŠÙŠØ± Ø§Ù„ÙÙ†ÙŠØ© ÙˆØ§Ù„Ø§Ù…ØªØ«Ø§Ù„ Ù„Ù„ÙˆØ§Ø¦Ø­ Ø§Ù„Ù…Ø­Ù„ÙŠØ© Ù‚Ø¨Ù„ Ø£ÙŠ ØªØ·Ø¨ÙŠÙ‚ ÙÙŠ Ø§Ù„Ø¹Ø§Ù„Ù… Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ. Ù‡Ø°Ù‡ Ø§Ù„Ø£Ø¯Ø§Ø© ØºÙŠØ± ØªØ§Ø¨Ø¹Ø© Ø£Ùˆ Ù…Ø¹ØªÙ…Ø¯Ø© Ø£Ùˆ Ù…Ø¯Ø¹ÙˆÙ…Ø© Ù…Ù† Ù‚Ø¨Ù„ Ø£ÙŠ Ù…Ù†Ø¸Ù…Ø© Ù…Ø§ Ù„Ù… ÙŠÙØ°ÙƒØ± ØµØ±Ø§Ø­Ø©.",

  feedback_good: "âœ… ÙŠØ¨Ø¯Ùˆ Ø¬ÙŠØ¯Ø§Ù‹. ØªØ§Ø¨Ø¹ Ø¥Ù„Ù‰ Ø§Ù„Ù…Ù…Ø§Ø±Ø³Ø© Ù…Ø¹ Ø§Ù„Ø¥Ø´Ø±Ø§Ù/Ø§Ù„Ù…Ø¹Ø§ÙŠÙŠØ±.",
  feedback_partial: "ğŸŸ¡ Ø¬Ø²Ø¦ÙŠ. Ø±Ø§Ø¬Ø¹ Ø§Ù„Ù…Ø¹Ø§ÙŠÙŠØ± Ø§Ù„Ù…ÙÙ‚ÙˆØ¯Ø© ÙˆÙ‚Ù… Ø¨ØªØ­Ø³ÙŠÙ† Ø§Ù„ØªÙˆØ¬ÙŠÙ‡.",
  feedback_not_ready: "ğŸ”´ ØºÙŠØ± Ø¬Ø§Ù‡Ø². Ø£Ø¹Ø¯ ÙØ­Øµ Ø§Ù„Ø³Ù„Ø§Ù…Ø© ÙˆØ§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ù‚Ø¨Ù„ Ø§Ù„Ù…Ù…Ø§Ø±Ø³Ø©.",
  feedback_score: "Ø§Ù„Ù†ØªÙŠØ¬Ø©:",
  feedback_missing: "Ø§Ù„Ù…Ø¹Ø§ÙŠÙŠØ± Ø§Ù„Ù…ÙÙ‚ÙˆØ¯Ø©:",
  feedback_none: "- Ù„Ø§ Ø´ÙŠØ¡",
  feedback_improvements: "Ø§Ù„ØªØ­Ø³ÙŠÙ† Ø§Ù„ØªØ§Ù„ÙŠ:",
  feedback_suggested: "âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØªÙˆØ¬ÙŠÙ‡ Ø§Ù„Ù…Ù‚ØªØ±Ø­.\nÙ†ØµÙŠØ­Ø©: Ø§Ø¬Ø¹Ù„ Ø§Ù„ØªÙˆØ¬ÙŠÙ‡ Ù‚ØµÙŠØ±Ø§Ù‹ (3-5 Ù†Ù‚Ø§Ø·) Ø«Ù… Ø§Ù†Ù‚Ø± Ø¹Ù„Ù‰ \"Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø¹ Ø§Ù„ØªÙˆØ¬ÙŠÙ‡\" Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø¯Ù‚Ø© Ø£ÙØ¶Ù„."
  }
};


// ============================================================================
// LANGUAGE SWITCHING
// ============================================================================
let currentLang = 'en';

function switchLanguage(lang) {
  currentLang = lang;
  const html = document.documentElement;
  
  // Update lang attribute and direction
  html.setAttribute('lang', lang);
  html.setAttribute('dir', lang === 'ar' ? 'rtl' : 'ltr');
  
  // Update all elements with data-i18n
  document.querySelectorAll('[data-i18n]').forEach(el => {
    const key = el.getAttribute('data-i18n');
    if (key in translations[lang]) {
      if (key === 'howto_list') {
  el.innerHTML = translations[lang][key];
} else {
  el.textContent = translations[lang][key];
}
    }
  });
  
  // Update placeholders
  document.querySelectorAll('[data-i18n-placeholder]').forEach(el => {
    const key = el.getAttribute('data-i18n-placeholder');
    if (key === 'placeholder_guidance') {
      el.placeholder = translations[lang].placeholder_guidance;
    }
  });
  
  // Update active button
  document.querySelectorAll('.lang-btn').forEach(btn => {
    if (btn.getAttribute('data-lang') === lang) {
      btn.classList.add('active');
    } else {
      btn.classList.remove('active');
    }
  });
}

// Language toggle event listeners
document.addEventListener('DOMContentLoaded', () => {
  switchLanguage('en');

  document.querySelectorAll('.lang-btn').forEach(btn => {
    btn.addEventListener('click', () => {
      const lang = btn.getAttribute('data-lang');
      switchLanguage(lang);
    });
  });
});

// ============================================================================
// ORIGINAL FUNCTIONALITY (UNCHANGED)
// ============================================================================

function buildPrompt(stepText, occupation, task, guidanceText) {
  const base =
    `realistic vocational training illustration, competency-based training, ` +
    `${occupation || "technician"} performing task correctly, ` +
    `task: ${task || ""}, step: ${stepText}, ` +
    `correct posture and hand positioning, appropriate PPE, safe environment, ` +
    `clear tools and work area, realistic training workshop or jobsite, ` +
    `no text, no labels, no watermarks, not cartoon`;

  const guidance = (guidanceText || "").trim();
  if (!guidance) return base;

  return `${base}, guidance: ${guidance}`;
}

function pollinationsUrl(prompt) {
  const seed = Math.floor(Math.random() * 100000);
  const encoded = encodeURIComponent(prompt);
  return `https://image.pollinations.ai/prompt/${encoded}?width=896&height=504&seed=${seed}`;
}

function getStepContext(stepDiv) {
  return {
    stepText: stepDiv.innerText,
    occupation: stepDiv.getAttribute("data-occupation") || "",
    task: stepDiv.getAttribute("data-task") || "",
    guidanceEl: stepDiv.querySelector("textarea.guidance"),
    imgBox: stepDiv.querySelector(".imgwrap"),
    feedbackBox: stepDiv.querySelector(".feedback"),
    scoreEl: stepDiv.querySelector(".score")
  };
}

function showImage(imgBox, url, onDone, mode = 'generate') {
  const msg =
    mode === 'regenerate'
      ? translations[currentLang].loading_regenerate
      : translations[currentLang].loading_generate;

  imgBox.innerHTML = `
    <div class="loading">
      ${msg}<br/>
      <small>${translations[currentLang].loading_hint}</small>
    </div>
  `;

  const img = new Image();
  img.src = url;
  img.style.maxWidth = "100%";
  img.style.borderRadius = "6px";
  img.onload = () => {
    imgBox.innerHTML = "";
    imgBox.appendChild(img);
    
    // Show delete button when image is loaded
    const stepDiv = imgBox.closest(".step");
    if (stepDiv) updateDeleteButtonVisibility(stepDiv);
    
    if (onDone) onDone(true);
  };
  img.onerror = () => {
    imgBox.innerHTML = `<div class="loading">Failed to generate image. Try again.</div>`;
    if (onDone) onDone(false);
  };
}

function clearOutputs(btn) {
  const stepDiv = btn.closest(".step");
  const { imgBox, feedbackBox, scoreEl } = getStepContext(stepDiv);

  // Clear UI
  imgBox.innerHTML = `<div class="loading" data-i18n="no_image">${translations[currentLang].no_image}</div>`;
  feedbackBox.innerHTML = `<div class="loading" data-i18n="feedback_placeholder">${translations[currentLang].feedback_placeholder}</div>`;
  scoreEl.textContent = "0%";

  // Uncheck criteria
  stepDiv.querySelectorAll("input.pc").forEach(cb => cb.checked = false);
  
  // Delete saved image from localStorage
  const key = stepStorageKey(stepDiv);
  localStorage.removeItem(key);
  
  // Hide delete button
  updateDeleteButtonVisibility(stepDiv);
}

function deleteStepImage(btn) {
  const stepDiv = btn.closest(".step");
  const { imgBox, feedbackBox } = getStepContext(stepDiv);
  
  // Delete from localStorage
  const key = stepStorageKey(stepDiv);
  localStorage.removeItem(key);
  
  // Clear image from UI
  imgBox.innerHTML = `<div class="loading" data-i18n="no_image">${translations[currentLang].no_image}</div>`;
  
  // Show confirmation feedback
  const confirmMsg = currentLang === 'ar' ? 'ØªÙ… Ø­Ø°Ù Ø§Ù„ØµÙˆØ±Ø© Ø¨Ù†Ø¬Ø§Ø­.' : 'âœ“ Image deleted successfully.';
  feedbackBox.innerHTML = `<div class="loading">${confirmMsg}</div>`;
  
  // Hide delete button
  updateDeleteButtonVisibility(stepDiv);
  
  // Clear feedback after 2 seconds
  setTimeout(() => {
    feedbackBox.innerHTML = `<div class="loading" data-i18n="feedback_placeholder">${translations[currentLang].feedback_placeholder}</div>`;
  }, 2000);
}

function updateDeleteButtonVisibility(stepDiv) {
  const deleteBtn = stepDiv.querySelector(".delete-img-btn");
  const imgBox = stepDiv.querySelector(".imgwrap");
  const hasImage = imgBox.querySelector("img") !== null;
  
  if (deleteBtn) {
    deleteBtn.style.display = hasImage ? "inline-block" : "none";
  }
}

function generateIllustration(btn) {
  const stepDiv = btn.closest(".step");
  const { stepText, occupation, task, guidanceEl, imgBox } = getStepContext(stepDiv);

  btn.disabled = true;

  const prompt = buildPrompt(stepText, occupation, task, "");
  const url = pollinationsUrl(prompt);

showImage(imgBox, url, () => {
  btn.disabled = false;
}, 'generate');
}

function regenerateWithGuidance(btn) {
  const stepDiv = btn.closest(".step");
  const { stepText, occupation, task, guidanceEl, imgBox } = getStepContext(stepDiv);

  btn.disabled = true;

  const guidanceText = guidanceEl ? guidanceEl.value : "";
  const prompt = buildPrompt(stepText, occupation, task, guidanceText);
  const url = pollinationsUrl(prompt);

showImage(imgBox, url, () => {
  btn.disabled = false;
}, 'regenerate');
}
function checkAgainstCriteria(btn) {
  const stepDiv = btn.closest(".step");
  const { stepText, feedbackBox, scoreEl, guidanceEl } = getStepContext(stepDiv);

  const checks = Array.from(stepDiv.querySelectorAll("input.pc"));
  const total = checks.length;
  const passed = checks.filter(cb => cb.checked).length;
  const score = total === 0 ? 0 : Math.round((passed / total) * 100);
  scoreEl.textContent = `${score}%`;

  const missing = [];
  checks.forEach((cb, idx) => {
    if (!cb.checked) {
      const label = cb.closest(".criteria-item")?.querySelector("label")?.innerText?.trim();
      if (label) missing.push(`- ${label}`);
    }
  });

  const guidance = (guidanceEl?.value || "").trim();
  const tips = [];

  const s = stepText.toLowerCase();

  if (s.includes("power") || s.includes("breaker") || s.includes("electrical")) {
    tips.push("Suggestion: Add guidance like 'insulated gloves', 'lockout/tagout', 'stand to the side of the panel', and 'confirm power is OFF'.");
  }
  if (s.includes("wire") || s.includes("strip")) {
    tips.push("Suggestion: Add guidance like 'wire stripper tool visible', 'correct stripping length', and 'no nicked conductors'.");
  }
  if (!guidance) {
    tips.push("Tip: Use 'Regenerate with Guidance' to force key details (tools, PPE, angle, environment).");
  } else {
    tips.push("Tip: If the image is still off, simplify guidance to 3â€“5 clear points (PPE, tool, environment, key action).");
  }

  const verdict =
    score >= 80 ? translations[currentLang].feedback_good :
    score >= 50 ? translations[currentLang].feedback_partial :
                  translations[currentLang].feedback_not_ready;

  const feedbackText =
`${verdict}

${translations[currentLang].feedback_score} ${score}% (${passed}/${total})

${translations[currentLang].feedback_missing}
${missing.length ? missing.join("\n") : translations[currentLang].feedback_none}

${translations[currentLang].feedback_improvements}
${tips.map(t => `- ${t}`).join("\n")}
`;

  feedbackBox.textContent = feedbackText;
}

function suggestGuidance(btn) {
  const stepDiv = btn.closest(".step");
  const { stepText, occupation, task, guidanceEl, feedbackBox } = getStepContext(stepDiv);

  const s = (stepText || "").toLowerCase();
  const t = (task || "").toLowerCase();
  const o = (occupation || "technician").toLowerCase();

  const base = [
    `realistic ${o} training environment`,
    `correct procedure, safety focused`,
    `clear tools visible`,
    `correct posture and hand positioning`,
    `no text, no labels, no watermarks`
  ];

  const safetyElectrical = [
    "insulated gloves and safety glasses",
    "electrical panel/breaker clearly visible",
    "stand to the side of panel while switching",
    "lockout/tagout style safety emphasis",
    "no exposed live conductors shown"
  ];

  const wiring = [
    "wire stripper tool clearly visible",
    "correct stripping length shown",
    "clean copper strands (no damage)",
    "socket box mounted level and stable",
    "neat work area, no sharp hazards"
  ];

  const mechanical = [
    "use correct tool (wrench/screwdriver) visible",
    "safe grip and stable stance",
    "parts aligned correctly",
    "workbench/worksite organized"
  ];

  const ppeGeneral = [
    "PPE visible (gloves, goggles) as appropriate",
    "safe environment, hazard-free background"
  ];

  let picks = [...base];

  if (s.includes("power") || s.includes("breaker") || s.includes("electrical") || t.includes("electrical")) {
    picks = picks.concat(safetyElectrical);
  } else if (s.includes("wire") || s.includes("strip") || s.includes("socket") || t.includes("wire") || t.includes("socket")) {
    picks = picks.concat(wiring);
  } else if (s.includes("tighten") || s.includes("assemble") || s.includes("install") || t.includes("install") || t.includes("assemble")) {
    picks = picks.concat(mechanical);
  } else {
    picks = picks.concat(ppeGeneral);
  }

  const final = picks
    .filter(Boolean)
    .map(x => x.trim())
    .filter((x, i, arr) => arr.indexOf(x) === i)
    .slice(0, 7)
    .join(", ");

  if (guidanceEl) {
    guidanceEl.value = final;
    guidanceEl.focus();
  }

  if (feedbackBox) {
    feedbackBox.textContent = translations[currentLang].feedback_suggested;
  }
}

function stepStorageKey(stepDiv) {
   const task = stepDiv.getAttribute("data-task") || "step";
  return "saved_image_" + task.replace(/\s+/g, "_").toLowerCase();
}

function saveStepImage(btn) {
  const stepDiv = btn.closest(".step");
  const img = stepDiv.querySelector(".imgwrap img");

  if (!img || !img.src) {
    alert("No image to save yet.");
    return;
  }

  const key = stepStorageKey(stepDiv);
  localStorage.setItem(key, img.src);

  alert("Image saved for this step.");
  
  // Ensure delete button is visible after saving
  updateDeleteButtonVisibility(stepDiv);
}

function loadSavedImages() {
  document.querySelectorAll(".step").forEach(stepDiv => {
    const key = stepStorageKey(stepDiv);
    const saved = localStorage.getItem(key);
    if (saved) {
      const imgBox = stepDiv.querySelector(".imgwrap");
      imgBox.innerHTML = "";
      const img = new Image();
      img.src = saved;
      img.style.maxWidth = "100%";
      img.style.borderRadius = "6px";
      imgBox.appendChild(img);
      
      // Show delete button for saved images
      updateDeleteButtonVisibility(stepDiv);
    }
  });
}

window.addEventListener("DOMContentLoaded", loadSavedImages);

</script>
</body>
</html>